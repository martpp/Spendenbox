#include "Arduino.h"
#include "WiFi.h"
#include "Audio.h"
#include <Wire.h>
#include <VL6180X.h>

#include "config.h"

#define I2S_DOUT 25
#define I2S_BCLK 27
#define I2S_LRC 26

Audio audio;
VL6180X sensor;

void setup()
{
  WiFi.disconnect();
  WiFi.mode(WIFI_STA);
  WiFi.begin(ssid, password);

  while (WiFi.status() != WL_CONNECTED)
    delay(1500);

  audio.setPinout(I2S_BCLK, I2S_LRC, I2S_DOUT);
  audio.setVolume(255);

  Wire.begin(12, 21); // Use G12 (SCL) and G21 (SDA) for I2C on ESP32
  delay(100);

  if (sensor.init()) // Use init() instead of begin()
  {
    Serial.println("VL6180X sensor initialization failed. Freezing..."); // Initialize sensor and check for errors
    while (1);
  }

  sensor.setDefaultSettings(); // Load default settings to get started.

  delay(1000);
}

void playHighNote()
{
  audio.tone(1000); // Play a high note
  delay(500);       // Adjust the duration as needed
  audio.noTone();    // Stop the sound
}

void playLowNote()
{
  audio.tone(300); // Play a low note
  delay(500);      // Adjust the duration as needed
  audio.noTone();   // Stop the sound
}

void loop()
{
  if (sensor.readRange() < 20.)
  {
    playHighNote();
    Serial.println("big money");
  }
  else if (sensor.readRange() < 55.)
  {
    playLowNote();
    Serial.println("small money");
  }

  delay(50);
}
